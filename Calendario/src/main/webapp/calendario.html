<!DOCTYPE html>
<html>
    <head>
        <title>Calendario</title>
        <link rel="stylesheet" href="./calendario.css" type="text/css" media="all" />
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

        <script>
            contador = 0;
            function calendario(mes,anyo)
            {   

//                alert(mes,anyo);
                //Creamos esta fecha para comparar con la actual, ya que la otra será manipulada
                var fechaHoy = new Date();
                fechaHoy.setHours(0, 0, 0, 0);

                var fechaActual = new Date(fechaHoy.getFullYear(), fechaHoy.getMonth(), 1);
                
//                if(isNaN(anyo)) {
//                    fechaActual.setFullYear(fechaActual.getFullYear());
//                } else {
//                    fechaActual.setFullYear(anyo);
//                }
                
                if (mes === 12) {
                    contador--;
                    fechaActual.setMonth(fechaActual.getMonth() + contador);
                }
                if (mes === 13) {
                    contador++;
                    fechaActual.setMonth(fechaActual.getMonth() + contador);
                }
                if (mes >= 0 && mes <=11) {
                    fechaActual.setMonth(mes);
                }

                if (isNaN(mes)) {
                    contador = 0;
                }

                var fechaUltimoDia = new Date(fechaActual.getFullYear(), fechaActual.getMonth() + 1, 0);
                var mesActual = fechaActual.getMonth();
                var ultimoDia = fechaUltimoDia.getDate();
                //Se le pone menos uno porque te da la semana del 1-0 y lo quiero del 0-6 para el vector
                var posicionSemana = fechaActual.getDay() - 1;
                //Da -1 ya que al coger el dato domingo es 0 por America
                if (posicionSemana === -1) {
                    posicionSemana = 6;
                }
                var meses = ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"];
                var dias = ["Lunes", "Martes", "Miercoles", "Jueves", "Viernes", "Sábado", "Domingo"];

                mihtml = "<table border=0>";
                mihtml += "<tr class=cabecera>\n\
                <th><a class=flechas href=# onclick=calendario(12," + fechaActual.getFullYear() + ");return false;><font size=6><<</font></a></th>\n\
                <th class=mes colspan=5><font  size=19>" + meses[mesActual] + "\t</font><font size=3>" + fechaActual.getFullYear() + "</font></th>\n\
                <th><a class=flechas href=# onclick=calendario(13," + fechaActual.getFullYear() + ");return false;><font size=6>>></font></a></th></tr>";
                mihtml += "<tr>";
                for (i = 0; i < dias.length; i++) {
                    mihtml += "<td class=dias_nombre>" + dias[i] + "</td>";
                }
                mihtml += "</tr>";

                //Rellena dias que no empieza en lunes
                if (posicionSemana !== 0) {
                    mihtml += "<tr>";
                    for (f = 0; f < posicionSemana; f++) {
                        mihtml += "<td class=vacio></td>";
                    }
                }

                //Empieza a poner dias
                for (i = 1; i <= ultimoDia; i++)
                {
                    var comparador = new Date(fechaActual.getFullYear(), fechaActual.getMonth(), i);
                    if (posicionSemana === 0) {
                        if (fechaHoy.getTime() === comparador.getTime()) {
                            mihtml += "<tr>";
                            mihtml += "<td class=dias id=hoy>" + i + "</td>";
                        } else {
                            mihtml += "<tr>";
                            mihtml += "<td class=dias>" + i + "</td>";
                        }
                        posicionSemana++;

                    } else if (posicionSemana === 6) {
                        if (fechaHoy.getTime() === comparador.getTime()) {
                            mihtml += "<td class=dias id=hoy>" + i + "</td>";
                            mihtml += "</tr>";
                        } else {
                            mihtml += "<td class=dias>" + i + "</td>";
                            mihtml += "</tr>";
                        }
                        posicionSemana = 0;

                    } else {
                        if (fechaHoy.getTime() === comparador.getTime()) {
                            mihtml += "<td class=dias id=hoy>" + i + "</td>";
                        } else {
                            mihtml += "<td class=dias>" + i + "</td>";
                        }
                        posicionSemana++;
                    }
                }

                //Rellena los huecos finales vacios del calendario
                if (posicionSemana === 0) {
                    posicionSemana = 7;
                }

                while (posicionSemana <= 6) {
                    mihtml += "<td class=vacio></td>";
                    if (posicionSemana === 6) {
                        mihtml += "</tr>";
                    }
                    posicionSemana++;
                }


                mihtml += "</table>";

                mihtml += "<br>";
                mihtml += "<select id=mes_selector name=selector>";
                if (fechaActual.getMonth() === 0) {
                    mihtml += "<option value=0 SELECTED>Enero</option>";
                } else {
                    mihtml += "<option value=0>Enero</option>";
                }
                if (fechaActual.getMonth() === 1) {
                    mihtml += "<option value=1 SELECTED>Febrero</option>";
                } else {
                    mihtml += "<option value=1>Febrero</option>";
                }
                if (fechaActual.getMonth() === 2) {
                    mihtml += "<option value=2 SELECTED>Marzo</option>";
                } else {
                    mihtml += "<option value=2>Marzo</option>";
                }
                if (fechaActual.getMonth() === 3) {
                    mihtml += "<option value=3 SELECTED>Abril</option>";
                } else {
                    mihtml += "<option value=3>Abril</option>";
                }
                if (fechaActual.getMonth() === 4) {
                    mihtml += "<option value=4 SELECTED>Mayo</option>";
                } else {
                    mihtml += "<option value=4>Mayo</option>";
                }
                if (fechaActual.getMonth() === 5) {
                    mihtml += "<option value=5 SELECTED>Junio</option>";
                } else {
                    mihtml += "<option value=5>Junio</option>";
                }
                if (fechaActual.getMonth() === 6) {
                    mihtml += "<option value=6 SELECTED>Julio</option>";
                } else {
                    mihtml += "<option value=6>Julio</option>";
                }
                if (fechaActual.getMonth() === 7) {
                    mihtml += "<option value=7 SELECTED>Agosto</option>";
                } else {
                    mihtml += "<option value=7>Agosto</option>";
                }
                if (fechaActual.getMonth() === 8) {
                    mihtml += "<option value=8 SELECTED>Septiembre</option>";
                } else {
                    mihtml += "<option value=8>Septiembre</option>";
                }
                if (fechaActual.getMonth() === 9) {
                    mihtml += "<option value=9 SELECTED>Octubre</option>";
                } else {
                    mihtml += "<option value=9>Octubre</option>";
                }
                if (fechaActual.getMonth() === 10) {
                    mihtml += "<option value=10 SELECTED>Noviembre</option>";
                } else {
                    mihtml += "<option value=10>Noviembre</option>";
                }
                if (fechaActual.getMonth() === 11) {
                    mihtml += "<option value=11 SELECTED>Diciembre</option>";
                } else {
                    mihtml += "<option value=11>Diciembre</option>";
                }
                mihtml += "</select>";

                mihtml += "<input type=text name=texto size=9 id=anyo_texto></input>";
//                mihtml +="<button value=Ir onclick=calendario("+document.getElementById("mes_selector").value+","+document.getElementById("anyo_texto").value+")>Ir</button>";
                mihtml += "<button value=Ir onclick=calendario(6,2016)>Ir</button>";
                


                document.getElementById("contenedor").innerHTML = mihtml;
            }
        </script>
    </head>
    <body>
        <div id="top" align="center">
            <button onclick="calendario()">Calendario Actual</button>
        </div>
        <br>
        <br>
        <div id="contenedor" align="center">
        </div>
    </body>
</html>